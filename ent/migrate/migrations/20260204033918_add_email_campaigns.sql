-- Create "email_campaigns" table
CREATE TABLE "email_campaigns" (
  "id" bigint NOT NULL GENERATED BY DEFAULT AS IDENTITY,
  "name" character varying NOT NULL,
  "subject" character varying NOT NULL,
  "content_html" text NOT NULL,
  "content_text" text NULL,
  "status" character varying NOT NULL DEFAULT 'draft',
  "from_email" character varying NOT NULL,
  "from_name" character varying NOT NULL,
  "reply_to" character varying NULL,
  "scheduled_at" timestamptz NULL,
  "sent_at" timestamptz NULL,
  "recipients_count" bigint NOT NULL DEFAULT 0,
  "sent_count" bigint NOT NULL DEFAULT 0,
  "failed_count" bigint NOT NULL DEFAULT 0,
  "opened_count" bigint NOT NULL DEFAULT 0,
  "clicked_count" bigint NOT NULL DEFAULT 0,
  "unsubscribed_count" bigint NOT NULL DEFAULT 0,
  "tags" jsonb NULL,
  "sendgrid_batch_id" character varying NULL,
  "created_at" timestamptz NOT NULL,
  "updated_at" timestamptz NOT NULL,
  "user_id" bigint NOT NULL,
  PRIMARY KEY ("id"),
  CONSTRAINT "email_campaigns_users_email_campaigns" FOREIGN KEY ("user_id") REFERENCES "users" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION
);
-- Create index "emailcampaign_created_at" to table: "email_campaigns"
CREATE INDEX "emailcampaign_created_at" ON "email_campaigns" ("created_at");
-- Create index "emailcampaign_scheduled_at" to table: "email_campaigns"
CREATE INDEX "emailcampaign_scheduled_at" ON "email_campaigns" ("scheduled_at");
-- Create index "emailcampaign_sent_at" to table: "email_campaigns"
CREATE INDEX "emailcampaign_sent_at" ON "email_campaigns" ("sent_at");
-- Create index "emailcampaign_status" to table: "email_campaigns"
CREATE INDEX "emailcampaign_status" ON "email_campaigns" ("status");
-- Create index "emailcampaign_user_id" to table: "email_campaigns"
CREATE INDEX "emailcampaign_user_id" ON "email_campaigns" ("user_id");
-- Create "email_campaign_recipients" table
CREATE TABLE "email_campaign_recipients" (
  "id" bigint NOT NULL GENERATED BY DEFAULT AS IDENTITY,
  "email" character varying NOT NULL,
  "name" character varying NULL,
  "status" character varying NOT NULL DEFAULT 'pending',
  "sent_at" timestamptz NULL,
  "opened_at" timestamptz NULL,
  "clicked_at" timestamptz NULL,
  "unsubscribed_at" timestamptz NULL,
  "failure_reason" character varying NULL,
  "sendgrid_message_id" character varying NULL,
  "created_at" timestamptz NOT NULL,
  "updated_at" timestamptz NOT NULL,
  "campaign_id" bigint NOT NULL,
  PRIMARY KEY ("id"),
  CONSTRAINT "email_campaign_recipients_email_campaigns_recipients" FOREIGN KEY ("campaign_id") REFERENCES "email_campaigns" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION
);
-- Create index "emailcampaignrecipient_campaign_id" to table: "email_campaign_recipients"
CREATE INDEX "emailcampaignrecipient_campaign_id" ON "email_campaign_recipients" ("campaign_id");
-- Create index "emailcampaignrecipient_campaign_id_email" to table: "email_campaign_recipients"
CREATE UNIQUE INDEX "emailcampaignrecipient_campaign_id_email" ON "email_campaign_recipients" ("campaign_id", "email");
-- Create index "emailcampaignrecipient_created_at" to table: "email_campaign_recipients"
CREATE INDEX "emailcampaignrecipient_created_at" ON "email_campaign_recipients" ("created_at");
-- Create index "emailcampaignrecipient_email" to table: "email_campaign_recipients"
CREATE INDEX "emailcampaignrecipient_email" ON "email_campaign_recipients" ("email");
-- Create index "emailcampaignrecipient_sent_at" to table: "email_campaign_recipients"
CREATE INDEX "emailcampaignrecipient_sent_at" ON "email_campaign_recipients" ("sent_at");
-- Create index "emailcampaignrecipient_status" to table: "email_campaign_recipients"
CREATE INDEX "emailcampaignrecipient_status" ON "email_campaign_recipients" ("status");
