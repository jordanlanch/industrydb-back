-- Create "crm_integrations" table
CREATE TABLE "crm_integrations" (
  "id" bigint NOT NULL GENERATED BY DEFAULT AS IDENTITY,
  "provider" character varying NOT NULL,
  "enabled" boolean NOT NULL DEFAULT true,
  "access_token" character varying NOT NULL,
  "refresh_token" character varying NULL,
  "token_expires_at" timestamptz NULL,
  "instance_url" character varying NULL,
  "api_key" character varying NULL,
  "settings" jsonb NULL,
  "sync_direction" character varying NOT NULL DEFAULT 'bidirectional',
  "auto_sync" boolean NOT NULL DEFAULT false,
  "sync_interval_minutes" bigint NOT NULL DEFAULT 15,
  "last_sync_at" timestamptz NULL,
  "last_sync_error" character varying NULL,
  "synced_leads_count" bigint NOT NULL DEFAULT 0,
  "created_at" timestamptz NOT NULL,
  "updated_at" timestamptz NOT NULL,
  "user_id" bigint NOT NULL,
  PRIMARY KEY ("id"),
  CONSTRAINT "crm_integrations_users_crm_integrations" FOREIGN KEY ("user_id") REFERENCES "users" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION
);
-- Create index "crmintegration_enabled" to table: "crm_integrations"
CREATE INDEX "crmintegration_enabled" ON "crm_integrations" ("enabled");
-- Create index "crmintegration_last_sync_at" to table: "crm_integrations"
CREATE INDEX "crmintegration_last_sync_at" ON "crm_integrations" ("last_sync_at");
-- Create index "crmintegration_provider" to table: "crm_integrations"
CREATE INDEX "crmintegration_provider" ON "crm_integrations" ("provider");
-- Create index "crmintegration_user_id" to table: "crm_integrations"
CREATE INDEX "crmintegration_user_id" ON "crm_integrations" ("user_id");
-- Create index "crmintegration_user_id_provider" to table: "crm_integrations"
CREATE UNIQUE INDEX "crmintegration_user_id_provider" ON "crm_integrations" ("user_id", "provider");
-- Create "crm_lead_syncs" table
CREATE TABLE "crm_lead_syncs" (
  "id" bigint NOT NULL GENERATED BY DEFAULT AS IDENTITY,
  "lead_id" bigint NOT NULL,
  "crm_lead_id" character varying NOT NULL,
  "sync_status" character varying NOT NULL DEFAULT 'pending',
  "sync_direction" character varying NOT NULL,
  "synced_at" timestamptz NULL,
  "sync_error" character varying NULL,
  "crm_data" jsonb NULL,
  "auto_update" boolean NOT NULL DEFAULT true,
  "created_at" timestamptz NOT NULL,
  "updated_at" timestamptz NOT NULL,
  "integration_id" bigint NOT NULL,
  PRIMARY KEY ("id"),
  CONSTRAINT "crm_lead_syncs_crm_integrations_synced_leads" FOREIGN KEY ("integration_id") REFERENCES "crm_integrations" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION
);
-- Create index "crmleadsync_crm_lead_id" to table: "crm_lead_syncs"
CREATE INDEX "crmleadsync_crm_lead_id" ON "crm_lead_syncs" ("crm_lead_id");
-- Create index "crmleadsync_integration_id" to table: "crm_lead_syncs"
CREATE INDEX "crmleadsync_integration_id" ON "crm_lead_syncs" ("integration_id");
-- Create index "crmleadsync_integration_id_lead_id" to table: "crm_lead_syncs"
CREATE UNIQUE INDEX "crmleadsync_integration_id_lead_id" ON "crm_lead_syncs" ("integration_id", "lead_id");
-- Create index "crmleadsync_lead_id" to table: "crm_lead_syncs"
CREATE INDEX "crmleadsync_lead_id" ON "crm_lead_syncs" ("lead_id");
-- Create index "crmleadsync_sync_status" to table: "crm_lead_syncs"
CREATE INDEX "crmleadsync_sync_status" ON "crm_lead_syncs" ("sync_status");
-- Create index "crmleadsync_synced_at" to table: "crm_lead_syncs"
CREATE INDEX "crmleadsync_synced_at" ON "crm_lead_syncs" ("synced_at");
